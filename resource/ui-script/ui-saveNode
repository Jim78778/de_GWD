#!/bin/bash
if [[ $(awk '/listW/ {print;exit}' /usr/local/bin/0conf) =~ "[" ]]; then
	listW=$(jq -r '.listW[]' /usr/local/bin/0conf)
elif [[ $(awk '/listW/ {print;exit}' /usr/local/bin/0conf) =~ "{" ]]; then
	listW=$(jq -r '.listW | keys[]' /usr/local/bin/0conf)
fi

jq -r '.v2node[].domain' /usr/local/bin/0conf | cut -d: -f1 >/tmp/listW
if [[ -n "$listW" ]]; then
	echo $listW  >>/tmp/listW
fi
jq '.listW=[]' /usr/local/bin/0conf >/tmp/0conf_temp
for listWpre in $(cat /tmp/listW); do
	jq --arg listWpre $listWpre '.listW += [$listWpre]' /tmp/0conf_temp >/tmp/0conf_temp2 && mv -f /tmp/0conf_temp2 /tmp/0conf_temp
done

mv -f /tmp/0conf_temp /usr/local/bin/0conf

/usr/local/bin/ui-changeDOH
